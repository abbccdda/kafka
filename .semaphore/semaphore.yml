version: v1.0
name: ce-kafka
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804
blocks:
  - name: "Build, Test, Release"
    task:
      secrets:
        - name: semaphore-secrets-global
        - name: artifactory-docker-helm
        - name: testbreak-reporting
        - name: aws_credentials
        - name: ssh_id_rsa
        - name: ssh_config
        - name: gitconfig
        - name: netrc
        - name: maven-settings
        - name: gradle_properties
      prologue:
        commands:
          - sem-version java 8
          - git config --global url."git@github.com:".insteadOf "https://github.com/"
          - chmod 400 ~/.ssh/id_rsa
          - export SEMAPHORE_CACHE_DIR=/home/semaphore
          - checkout
          - source /home/semaphore/.testbreak/setup.sh
      jobs:
        - name: Setup, build, release
          commands:
            - make init-ci
            - make build
            - make release-ci
      epilogue:
        commands:
          - source /home/semaphore/.testbreak/after.sh